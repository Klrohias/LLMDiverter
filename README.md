# LLM API Diverter

ä¸€ä¸ªè½»é‡çº§çš„ LLM API åˆ†æµå™¨ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·ç®¡ç†å’Œä¼˜åŒ–å¯¹å¤šä¸ªå¤§è¯­è¨€æ¨¡å‹æœåŠ¡ï¼ˆä¸Šæ¸¸ï¼‰çš„è°ƒç”¨ã€‚è¯¥åˆ†æµå™¨å…¼å®¹ OpenAI API æ ¼å¼ï¼Œé€šè¿‡æ™ºèƒ½è·¯ç”±å’Œæƒé‡åˆ†é…ï¼Œå®ç°è¯·æ±‚åœ¨ä¸åŒæ¨¡å‹æä¾›å•†ä¹‹é—´çš„çµæ´»åˆ†å‘ï¼Œå¹¶æ”¯æŒæ¨¡å‹åç§°çš„é‡æ˜ å°„ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

*   **å¤šä¸Šæ¸¸æ”¯æŒ**: é…ç½®å¤šä¸ª LLM API ä¸Šæ¸¸æœåŠ¡ï¼Œæ”¯æŒä¸åŒçš„ API Key å’Œæ ¹åœ°å€ã€‚
*   **æ™ºèƒ½åˆ†æµ**: æ ¹æ®è¯·æ±‚ä¸­çš„æ¨¡å‹åç§°ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°é…ç½®çš„ä¸Šæ¸¸æœåŠ¡ã€‚
*   **æƒé‡åˆ†é…**: ä¸ºæ¯ä¸ªä¸Šæ¸¸æœåŠ¡æˆ–ç‰¹å®šæ¨¡å‹è®¾ç½® `rate`ï¼ˆå€ç‡ï¼‰ï¼Œå®ç°æŒ‰æ¯”ä¾‹çš„è¯·æ±‚åˆ†å‘ï¼Œä¼˜åŒ–æˆæœ¬æˆ–æé«˜å¯ç”¨æ€§ã€‚
*   **æ¨¡å‹åç§°é‡æ˜ å°„**: å…è®¸å°†è¯·æ±‚ä¸­ä½¿ç”¨çš„æ¨¡å‹åç§°çµæ´»åœ°æ˜ å°„åˆ°ä¸Šæ¸¸æœåŠ¡å®é™…æ”¯æŒçš„æ¨¡å‹åç§°ï¼Œæé«˜å…¼å®¹æ€§ã€‚
*   **OpenAI API å…¼å®¹**: æä¾›ä¸ OpenAI `/v1/chat/completions` æ¥å£å…¼å®¹çš„å…¥å£ï¼Œæ–¹ä¾¿ç°æœ‰åº”ç”¨æ— ç¼è¿ç§»ã€‚
*   **YAML é…ç½®**: æ‰€æœ‰é…ç½®é¡¹é€šè¿‡æ˜“äºé˜…è¯»å’Œç®¡ç†çš„ `config.yml` æ–‡ä»¶è¿›è¡Œå®šä¹‰ã€‚
*   **è®¤è¯æ”¯æŒ (å¯é€‰)**: å…·å¤‡ API Key è®¤è¯æœºåˆ¶ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

*   **Node.js**: è¿è¡Œæ—¶ç¯å¢ƒ
*   **Express**: å¿«é€Ÿã€å¼€æ”¾ã€æç®€çš„ Web æ¡†æ¶
*   **TypeScript**: æä¾›ç±»å‹å®‰å…¨ï¼Œæé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
*   **`js-yaml`**: YAML è§£æåº“
*   **`esbuild`**: ç”¨äºå¿«é€Ÿæ‰“åŒ…å’Œæ„å»º

## âš™ï¸ å®‰è£…ä¸è¿è¡Œ

### å‰ææ¡ä»¶

*   Node.js (ç‰ˆæœ¬ 18 æˆ–æ›´é«˜æ¨è)
*   PNPM

### å®‰è£…

1.  å…‹éš†æœ¬é¡¹ç›®åˆ°æœ¬åœ°ï¼š
    ```bash
    git clone https://github.com/Klrohias/LLMDiverter.git
    cd LLMDiverter
    ```
2.  å®‰è£…ä¾èµ–ï¼š
    ```bash
    pnpm install
    ```

### é…ç½®

ç¼–è¾‘æ ¹ç›®å½•ä¸‹çš„ `config.yml` æ–‡ä»¶ä»¥é…ç½®ä½ çš„ä¸Šæ¸¸ LLM API æœåŠ¡ã€‚ä¸€ä¸ªç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼š

```yaml
listenPort: 16388 # æœåŠ¡ç›‘å¬çš„ç«¯å£
# acceptedKeys: # å¯é€‰ï¼šå¦‚æœå¯ç”¨è®¤è¯ï¼Œæ­¤å¤„åˆ—å‡ºæ‰€æœ‰æ¥å—çš„ API Keys
#   - your_api_key_1
#   - your_api_key_2
# adminToken: your_admin_token # å¯é€‰ï¼šç®¡ç†æ¥å£çš„è®¤è¯ Token
upstreams:
  - name: xxx # ä¸Šæ¸¸æœåŠ¡çš„åç§°
    apiRoot: https://example.com/v1 # ä¸Šæ¸¸æœåŠ¡çš„ API æ ¹åœ°å€
    apiKey: Your Key # ä¸Šæ¸¸æœåŠ¡çš„ API Key
    models:
      - { name: gpt-4o-mini, rate: 0.4 } # æ¨¡å‹åç§°å’Œç›¸å¯¹å€ç‡
      - { name: deepseek-v3, rate: 5 }
      - { name: deepseek-r1, rate: 10 }
      - { name: qwen3-8b, rate: 1.25 }
  - name: openrouter # å¦ä¸€ä¸ªä¸Šæ¸¸æœåŠ¡
    apiRoot: https://openrouter.ai/api/v1
    apiKey: Your Key
    models:
      - { name: deepseek-r1, rename: deepseek/deepseek-r1-0528:free, rate: 1 } # æ¨¡å‹åç§°é‡æ˜ å°„ç¤ºä¾‹
      - { name: deepseek-v3, rename: deepseek/deepseek-chat-v3:free, rate: 1 }
```

**é…ç½®è¯´æ˜**:

*   `listenPort`: æœ¬åœ°æœåŠ¡ç›‘å¬çš„ç«¯å£ã€‚
*   `acceptedKeys` (å¯é€‰): ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¦‚æœæä¾›ï¼Œåˆ™æ‰€æœ‰ä¼ å…¥è¯·æ±‚å¿…é¡»åœ¨ `Authorization` å¤´ä¸­åŒ…å«è¿™äº› Key ä¹‹ä¸€ã€‚
*   `adminToken` (å¯é€‰): ç”¨äºè®¿é—®ç®¡ç†æ¥å£çš„ Tokenã€‚
*   `upstreams`: ä¸Šæ¸¸ LLM API æœåŠ¡çš„åˆ—è¡¨ã€‚
    *   `name`: ä¸Šæ¸¸æœåŠ¡çš„å”¯ä¸€æ ‡è¯†åç§°ã€‚
    *   `apiRoot`: ä¸Šæ¸¸ API çš„æ ¹åœ°å€ã€‚
    *   `apiKey`: ä¸Šæ¸¸ API çš„è®¤è¯ Keyã€‚
    *   `models`: è¯¥ä¸Šæ¸¸æœåŠ¡æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨ã€‚
        *   `name`: æœ¬åœ°è¯·æ±‚ä¸­ä½¿ç”¨çš„æ¨¡å‹åç§°ã€‚
        *   `rate` (å¯é€‰): è¯¥æ¨¡å‹åœ¨æ­¤ä¸Šæ¸¸çš„å€ç‡ã€‚**å€¼è¶Šå¤§ï¼Œä»£è¡¨åœ¨è¿™ä¸ªä¸Šæµè°ƒç”¨è¯¥æ¨¡å‹çš„å¼€é”€æ›´å¤§ï¼Œè¢«é€‰ä¸­çš„æ¦‚ç‡è¶Šä½**ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º 1ã€‚
        *   `rename` (å¯é€‰): å¦‚æœä¸Šæ¸¸æœåŠ¡å¯¹è¯¥æ¨¡å‹çš„åç§°æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå¯ä»¥åœ¨æ­¤æŒ‡å®šå…¶çœŸå®åç§°ã€‚

### è¿è¡Œ

åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š

```bash
pnpm dev
```

æœåŠ¡é»˜è®¤ä¼šåœ¨ `config.yml` ä¸­é…ç½®çš„ `listenPort` (é»˜è®¤ä¸º `8081`) å¯åŠ¨ã€‚

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

å¯åŠ¨æœåŠ¡åï¼Œæ‚¨å¯ä»¥å°†åŸå…ˆæŒ‡å‘ LLM API æä¾›å•†çš„è¯·æ±‚åœ°å€æ”¹ä¸ºæŒ‡å‘æ­¤åˆ†æµå™¨çš„åœ°å€ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åŸå…ˆå‘ `https://api.openai.com/v1/chat/completions` å‘é€è¯·æ±‚ï¼Œç°åœ¨å¯ä»¥å‘é€åˆ° `http://localhost:16388/v1/chat/completions` (å‡è®¾æ‚¨çš„ `listenPort` æ˜¯ 16388)ã€‚

åˆ†æµå™¨ä¼šæ ¹æ®æ‚¨è¯·æ±‚ä¸­çš„ `model` å­—æ®µï¼Œç»“åˆ `config.yml` ä¸­çš„é…ç½®ï¼Œé€‰æ‹©åˆé€‚çš„ä¸Šæ¸¸æœåŠ¡è¿›è¡Œè½¬å‘ã€‚

```javascript
// å‡è®¾ä½¿ç”¨ fetch API
fetch('http://localhost:16388/v1/chat/completions', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    // å¦‚æœ config.yml ä¸­é…ç½®äº† acceptedKeysï¼Œåˆ™éœ€è¦æä¾›ä¸€ä¸ª
    // 'Authorization': 'Bearer your_api_key_1',

    // å¯ä»¥ä½¿ç”¨ X-Upstream å¼ºåˆ¶æŒ‡å®šä»æŸä¸ªä¸Šæµè°ƒç”¨
    // 'X-Upstream': 'XX'
  },
  body: JSON.stringify({
    model: 'deepseek-v3', // è¿™ä¸ªæ¨¡å‹åç§°ä¼šåœ¨é…ç½®ä¸­æŸ¥æ‰¾å¯¹åº”çš„ä¸Šæ¸¸
    messages: [
      { role: 'user', content: 'Hello, what is your name?' }
    ]
  })
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));

```

## è´¡çŒ®

æ¬¢è¿é€šè¿‡ Pull Request æˆ– Issues æå‡ºå»ºè®®å’Œè´¡çŒ®ã€‚
